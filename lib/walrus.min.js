var Walrus={$:{version:"0.2"},forVariablesTable:{},ifVariablesTable:{},inputVariablesTable:{},variablesTable:{},variables:[],initialize:function(e){e(this.$);for(var t in this.$)this.variablesTable[t]=[],this.variables.push(t),watch(t,this._watcher);return this._initControllers(document.body,0),this._lookForInlineVariables(document.body.innerHTML),this},_lookForInlineVariables:function(e){for(var t,r=/{{([^}]+)}}/g;t=r.exec(e);){var a=t[1].trim();Walrus.variablesTable[a]||(Walrus.variablesTable[a]=[],Walrus.variables.push(a),watch(a,Walrus._watcher))}},_watcher:function(e,t,r){for(var a=Walrus.variablesTable[e],l=0,n=a.length;l<n;l++){var i=a[l];i.childNodes[0].nodeValue=Walrus.render(i,i.originalNodeValue,Walrus.$)}if(Walrus.ifVariablesTable[e]){var s=0;for(n=Walrus.ifVariablesTable[e].length;s<n;s++){(u=Walrus.ifVariablesTable[e][s]).style.display=Walrus.$[e]?null:"none"}}if(Walrus.forVariablesTable[e]){var o=0;for(n=Walrus.forVariablesTable[e].length;o<n;o++){var u,f=(u=Walrus.forVariablesTable[e][o]).getAttribute("w-for").split("in")[0].replace(/\s/g,"");Walrus._executeFor(u,e,f)}}},_initControllers:function(el,n){var self=this;if(el.getAttribute("w-value")){self.inputVariablesTable[key]||(self.inputVariablesTable[key]=[]),el.value=Walrus.$[el.getAttribute("w-value")];var changeHandler=function(e){Walrus.$[el.getAttribute("w-value")]=e.target.value};el.addEventListener("input",changeHandler,!1),el.addEventListener("keyup",changeHandler,!1),el.addEventListener("paste",changeHandler,!1),el.addEventListener("mouseup",changeHandler,!1),self.inputVariablesTable[key].push(el)}if(el.getAttribute("w-click")&&(el.tapped=!1,el.addEventListener("click",function(event){if(!event.target.tapped)return eval(el.getAttribute("w-click"))},!1),el.addEventListener("touchstart",function(e){return e.target.tapped=!0},!1),el.addEventListener("touchmove",function(e){return e.target.tapped=!1,e.stopImmediatePropagation()},!1),el.addEventListener("touchend",function(event){if(event.target.tapped)return eval(el.getAttribute("w-click"))},!1)),el.getAttribute("w-include")){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){self._lookForInlineVariables(this.responseText),el.innerHTML=this.responseText;for(var e=el.children,t=0,r=e.length;t<r;t++)self._initControllers(e[t],n+1);self._render(el,self.$)}},xhttp.open("GET",el.getAttribute("w-include"),!0),xhttp.send()}if(el.getAttribute("w-if")){var key=el.getAttribute("w-if"),val=self.$[key];val||(el.style.display="none"),self.ifVariablesTable[key]||(self.ifVariablesTable[key]=[]),self.ifVariablesTable[key].push(el)}if(el.getAttribute("w-for")){var string=el.getAttribute("w-for"),arr=string.split("in"),key=arr[1].replace(/\s/g,""),elementKey=arr[0].replace(/\s/g,"");self.forVariablesTable[key]||(self.forVariablesTable[key]=[]),self.forVariablesTable[key].push(el),self._executeFor(el,key,elementKey)}for(var children=el.children,i=0,total=children.length;i<total;i++)self._initControllers(children[i],n+1);self._render(el,this.$)},_executeFor:function(e,t,r){e.style.display=null;var a=e.parentElement;if(a.forChildren)for(var l=0,n=a.forChildren.length;l<n;l++)a.removeChild(a.forChildren[l]);a.forChildren=[];var i=0;for(n=Walrus.$[t].length;i<n;i++){var s=e.cloneNode(!1),o=e.innerHTML;s.innerHTML=Walrus.render2(o,Walrus.$[t][i],r),a.appendChild(s),a.forChildren.push(s)}e.style.display="none"},_render:function(e,t){for(var r=e.getElementsByTagName("*"),a=0,l=r.length;a<l;a++){var n=r[a];n.childNodes.length&&n.childNodes[0].nodeValue&&!n.originalNodeValue&&(n.originalNodeValue=n.childNodes[0].nodeValue,n.childNodes[0].nodeValue=Walrus.render(n,n.childNodes[0].nodeValue,t))}},render:function(e,t,r,a){for(var l in Walrus.variables){var n=Walrus.variables[l],i="{{\\s?"+(a?a+".":"")+n+"\\s?}}",s=new RegExp(i,"gi");if((t.match(s)||[]).length){this.variablesTable[n].indexOf(e)<0&&this.variablesTable[n].push(e);var o=n.indexOf(".")<0?r[n]:byString(r,n);t=t.replace(new RegExp(i,"ig"),o)}}return t},render2:function(e,t,r){for(var a in t){var l="{{\\s?"+(r?r+".":"")+a+"\\s?}}",n=new RegExp(l,"gi"),i=((e.match(n)||[]).length,a.indexOf(".")<0?t[a]:byString(t,a));e=e.replace(new RegExp(l,"ig"),i)}return e}};function watch(e,t){if(e.indexOf(".")<0)__watch(Walrus.$,e,t);else{var r=e.split("."),a=r.pop(),l=r.join("."),n=byString(Walrus.$,l);n&&__watch(n,a,t,e)}}function __watch(e,t,r,a){if(null!=e.__lookupGetter__(t))return!0;var l=e[t],n=l,i=this,s=function(){return n},o=function(s){"[object Array]"===Object.prototype.toString.call(s)&&(s=_extendArray(s,r,i,t)),l=n,n=s,r.call(e,a||t,l,s)};return"[object Array]"===Object.prototype.toString.call(e[t])&&(e[t]=_extendArray(e[t],r,i,t,a)),delete e[t]&&(Object.defineProperty?Object.defineProperty(e,t,{get:s,set:o,enumerable:!1,configurable:!0}):Object.prototype.__defineGetter__&&Object.prototype.__defineSetter__&&(Object.prototype.__defineGetter__.call(e,t,s),Object.prototype.__defineSetter__.call(e,t,o))),this}function unwatch(e,t){var r=e[t];return delete e[t],e[t]=r,this}function _extendArray(e,t,r,a,l){var n;if(!0!==e.__wasExtended)return e.updated=function(e,r){t.call(this,l||a,e,this,n)},e.concat=i(e,"concat"),e.join=i(e,"join"),e.pop=i(e,"pop"),e.push=i(e,"push"),e.reverse=i(e,"reverse"),e.shift=i(e,"shift"),e.slice=i(e,"slice"),e.sort=i(e,"sort"),e.splice=i(e,"splice"),e.unshift=i(e,"unshift"),e.__wasExtended=!0,e;function i(e,t,r){return function(){var r=Array.prototype.concat.apply(e),a=Array.prototype[t].apply(e,arguments);return e.updated(r,n),a}}}function byString(e,t){for(var r=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),a=0,l=r.length;a<l;++a){var n=r[a];if(!(n in e))return;e=e[n]}return e}